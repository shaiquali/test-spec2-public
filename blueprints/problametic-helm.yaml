spec_version: 2
description: Generated by Torque IDP for 'events-ms' service
# blueprint inputs can be provided by the user, API or CI plugin when creating an environment from this blueprint.
# inputs:
#   host_name:
#     type: execution-host

inputs:
  host_name:
    type: string
    display-style: normal
    default: "eks"
  sa:
    type: string
    display-style: normal
    default: "shaip-sandbox"

outputs:

  ci:
    value: 'https://jenkins.qtorque.io/blue/organizations/jenkins/QualiTorque%2Fevents-ms/activity'
    kind: link
  repo:
    value: 'https://github.com/QualiTorque/events-ms'
    kind: link
  idp:
    value: 'https://idp.qtorque.io/catalog/default/component/events-ms'
    kind: link
  audit:
    value: 'https://elk.qtorque.io/goto/262e5cb0-47c7-11ed-bcb1-f3f57cd837de'
    kind: link
  logs:
    value: "https://elk.qtorque.io/app/discover#/view/2226b720-47c7-11ed-bcb1-f3f57cd837de?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-20m,to:now))&_a=(columns:!(kubernetes.deployment.name,kubernetes.labels.torque-environment-id,message),filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'0cb75e20-5d3f-11ed-bcb1-f3f57cd837de',key:kubernetes.labels.torque-blueprint-name,negate:!f,params:(query:''),type:phrase),query:(match_phrase:(kubernetes.labels.torque-blueprint-name:events-ms)))),grid:(),hideChart:!f,index:'0cb75e20-5d3f-11ed-bcb1-f3f57cd837de',interval:auto,query:(language:kuery,query:''),sort:!(!('@timestamp',desc)))"
    kind: link

grains:
  postgres:
    kind: helm
    spec:
      source:
        store: events-ms
        path: iac-events-ms/postgres
      agent:
        name: '{{ .inputs.host_name }}'
        service-account: '{{ .inputs.sa }}'
      inputs: []
      # The environment variables declared in this section will be available during the grain deployment as well as the grain destroy phase
      # env-vars:
      # - VAR_NAME: var value
      env-vars: []
      # Helm commands to run before installing the chart
      commands:
      - dep up iac-events-ms/postgres

  events-ms:
    kind: helm
    depends-on: postgres
    spec:
      source:
        store: events-ms
        path: iac-events-ms/node-app
      agent:
        name: '{{ .inputs.host_name }}'
        service-account: '{{ .inputs.sa }}'
      inputs: []
      # The environment variables declared in this section will be available during the grain deployment as well as the grain destroy phase
      # env-vars:
      # - VAR_NAME: var value
      env-vars: []
      # Helm commands to run before installing the chart
      commands:
      - dep up iac-events-ms/node-app
